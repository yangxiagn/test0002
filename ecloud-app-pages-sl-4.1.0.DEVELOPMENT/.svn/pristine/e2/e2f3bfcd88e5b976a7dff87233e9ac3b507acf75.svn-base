webpackJsonp([12],{"6zY7":function(e,t,a){var s=a("VU/8")(a("VJtz"),a("DDhp"),function(e){a("PTH6")},"data-v-da5b669c",null);e.exports=s.exports},DDhp:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sy-app-container"},[a("sy-grad-4",[2==e.$store.state.userType?a("div",{staticStyle:{"line-height":"40px"},slot:"headerRight"},["first"==e.activeName?a("el-button",{staticClass:"tele-button",on:{click:e.handleOpen}},[e._v("直播安排")]):e._e(),e._v(" "),a("el-tabs",{staticStyle:{display:"inline-block"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"直播设置",name:"first"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"直播统计",name:"second"}})],1)],1):e._e(),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticStyle:{padding:"10px"},attrs:{"element-loading-text":"拼命加载中..."},slot:"bodyRight"},["first"==e.activeName?a("el-table",{staticStyle:{width:"100%",height:"100%"},attrs:{data:e.tableData,border:"","tooltip-effect":"dark","empty-text":e.emptyText,height:"100%"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"48",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"title",label:"课堂名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"courseName",label:"直播学科",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"gradeName",label:"年级班级",align:2==e.$store.state.userType?"left":"center","header-align":"center"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"starttime",label:"直播开始时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.startTime))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"operate",label:"操作",width:"140",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[2==e.$store.state.userType?a("el-button",{attrs:{type:"text",size:"small",disabled:0!=t.row.liveDateType},on:{click:function(a){e.edit(t.row)}}},[e._v("修改")]):e._e(),e._v(" "),2==e.$store.state.userType?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.deleteMsg(t.row)}}},[e._v("删除")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.enterMsg(t.row)}}},[e._v("直播")])]}}])})],1):a("sys")],1),e._v(" "),"first"==e.activeName?a("div",{staticClass:"right",slot:"footer"},[a("el-pagination",{staticStyle:{display:"inline-block",padding:"0","padding-top":"5px"},attrs:{"current-page":e.currentPage,"page-size":100,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t}}})],1):e._e()]),e._v(" "),a("sy-dialog",{attrs:{title:e.isEdit?"修改直播":"直播安排",visible:e.dialogFormVisible,height:"430px",width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticStyle:{padding:"10px 15px 10px 10px"},slot:"body"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"90px",rules:e.rules}},[a("el-form-item",{attrs:{label:"课堂名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入名称",maxlength:100},model:{value:e.form.name,callback:function(t){e.form.name=t},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"直播学科：",prop:"courseValue"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择学科"},model:{value:e.form.courseValue,callback:function(t){e.form.courseValue=t},expression:"form.courseValue"}},e._l(e.subjects,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.courseValue}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择学生：",prop:"studentNames"}},[a("div",{staticClass:"el-input--small cp",on:{click:e.handleSelectUser}},[a("div",{staticClass:"el-input__inner",staticStyle:{"line-height":"24px",height:"auto"},style:{color:0==e.form.students.length?"rgb(151,160,190)":"rgb(31, 39, 61)"}},[e._v(e._s(0==e.form.students.length?"点击选择学生":e.form.studentNames))])]),e._v(" "),a("el-input",{staticStyle:{display:"none"},attrs:{placeholder:"请输入名称",maxlength:50},model:{value:e.form.studentNames,callback:function(t){e.form.studentNames=t},expression:"form.studentNames"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"直播时间：",prop:"date"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,editable:!1,type:"datetime",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.form.date,callback:function(t){e.form.date=t},expression:"form.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"直播说明：",prop:"desc"}},[a("el-input",{attrs:{type:"textarea",resize:"none",rows:5,maxlength:1e3,placeholder:"请输入500字以内的说明！"},model:{value:e.form.desc,callback:function(t){e.form.desc=t},expression:"form.desc"}})],1)],1)],1),e._v(" "),a("div",{slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.handleSubmit}},[e._v("提交")])],1)])],1)},staticRenderFns:[]}},PTH6:function(e,t){},VJtz:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("HcS1"),r=a("Go5i"),i=a.n(r);t.default={components:{sys:i.a},data:function(){return{activeName:"first",dialogLoading:!1,pageLoading:!1,isEdit:!1,tableData:[],dialogFormVisible:!1,saveLoading:!1,form:{id:"",name:"",courseValue:"",studentNames:"",students:[],grades:[],date:new Date,desc:""},rules:{name:[{required:!0,message:"请输入直播名称",trigger:"blur"},{min:3,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],desc:[{min:0,max:500,message:"长度在 0 到 500 个字符",trigger:"blur"}],courseValue:[{required:!0,message:"请选择直播课程",trigger:"change"}],date:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],studentNames:[{required:!0,message:"请选择学生",trigger:"change"}]},value1:"",pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},currentPage:1,total:0,iAdminRole:!1,subjects:[],tags:[]}},created:function(){this.$parent.$emit("currentPage","/sl/home/telecast"),this.init()},methods:{init:function(){this.refreshData(),this.getGradeCourseB()},refreshData:function(){var e=this;this.pageLoading=!0,a.i(s.a)({start:this.currentPage,size:30}).then(function(t){e.tableData=t.list||[],e.total=t.total,e.pageLoading=!1}).catch(function(t){e.pageLoading=!1})},handleCurrentChange:function(e){this.currentPage=e,this.refreshData()},handleClick:function(e,t){this.activeName=e.name},getGrades:function(e){var t=[];return e.forEach(function(e,a){e&&t.push(e.split("_")[0])}),t=this.$_.uniq(t)},getGradeCourseB:function(){var e=this;this.grade="",this.gradeOptios=[],a.i(s.c)(this.$store.state.unitId).then(function(t){e.existGradeCourseList=t.data.gradeCourseList||[];var a=t.data.roles||[];e.iAdminRole=!1,a.forEach(function(t,a){"XX_SYS_RC"!=t&&"XX_SYS_"!=t||(e.iAdminRole=!0)}),e.gradeCourseData=t.data||{},e.iAdminRole?(e.subjects=t.data.courseVMs||[],e.gradeOptios=t.data.gradeSimpleVMs):(e.getGrades(e.existGradeCourseList).forEach(function(a,s){e.gradeOptios.push(e.$_.find(t.data.gradeSimpleVMs,{gradeValue:a}))}),e.grade=e.gradeOptios.length>0?e.gradeOptios[0].id:"",e.subjects=e.gradeCourseData.courseRole[e.grade]),0!=e.existGradeCourseList.length||e.iAdminRole})},handleOpen:function(){this.isEdit=!1,this.dialogFormVisible=!0,this.form.students=[],this.form.grades=[],this.$refs.form.resetFields()},handleSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var r={content:e.form.desc,courseName:"",courseValue:e.form.courseValue,startTime:e.$moment(e.form.date).format("YYYY-MM-DD HH:mm:ss"),title:e.form.name,liveClassGradeClassRVMList:[],liveClassStudentVMList:[]};e.subjects.forEach(function(t,a){t.courseValue==e.form.courseValue&&(r.courseName=t.name)});var i=[];e.form.grades.forEach(function(e,t){e.children.forEach(function(t,a){i.push({classId:t.classId,className:t.className,gradeId:e.gradeId,gradeName:e.gradeName,gradeValue:e.gradeValue})})}),r.liveClassGradeClassRVMList=i;var n=[];e.form.students.forEach(function(e,t){n.push({userId:e.userId})}),r.liveClassStudentVMList=n,e.saveLoading=!0,e.isEdit?(r.id=e.form.id,r.liveClassGradeClassRVMList.forEach(function(t,a){t.liveId=e.form.id}),r.liveClassStudentVMList.forEach(function(t,a){t.liveId=e.form.id}),a.i(s.d)(r).then(function(t){e.$notify({message:"修改成功",type:"success"}),e.refreshData(),e.dialogFormVisible=!1,e.saveLoading=!1}).catch(function(t){e.saveLoading=!1})):a.i(s.e)(r).then(function(t){e.$notify({message:"安排成功",type:"success"}),e.currentPage=1,e.refreshData(),e.dialogFormVisible=!1,e.saveLoading=!1}).catch(function(t){e.saveLoading=!1})})},handleSelectUser:function(){var e=this,t=[];this.form.students.forEach(function(e,a){t.push(e.userId)}),this.$SelectUsers({selectUserType:1,unitType:2,userTypes:[1],unitId:this.$store.state.unitId,secondGroups:[],selectUserIds:t},function(t,a){var s=[],r=[],i=[];t.forEach(function(e,t){var a=!0;i.forEach(function(t,s){t.gradeId==e.gradeId&&(a=!1)}),a&&i.push({gradeValue:e.gradeValue,gradeName:e.gradeName,gradeId:e.gradeId,children:[]}),s.push({userName:e.realName,userId:e.id,classId:e.classId,className:e.className,number:e.number,gradeValue:e.gradeValue,gradeName:e.gradeName,gradeId:e.gradeId}),r.push(e.gradeName+e.className)}),i.forEach(function(e,a){t.forEach(function(t,a){if(t.gradeId==e.gradeId){var s=!0;e.children.forEach(function(e,a){e.classId==t.classId&&(s=!1)}),s&&e.children.push({classId:t.classId,className:t.className})}})}),e.form.grades=i,e.form.students=s,e.form.studentNames=e.$_.uniq(r).sort().join("、")})},edit:function(e){var t=this;this.isEdit=!0,this.dialogFormVisible=!0,this.form.id=e.liveId,this.dialogLoading=!0,a.i(s.f)(this.form.id).then(function(e){t.form.desc=e.content,t.form.name=e.title,t.form.date=new Date(e.startTime),t.form.courseValue=e.courseValue;var a=[],s=[],r=[];e.liveClassGradeClassRVMList&&(e.liveClassGradeClassRVMList.forEach(function(e,t){r.push(""+e.gradeName+e.className);var s=!0;a.forEach(function(t,a){t.gradeId==e.gradeId&&(s=!1)}),s&&a.push({gradeValue:e.gradeValue,gradeName:e.gradeName,gradeId:e.gradeId,children:[]})}),a.forEach(function(t,a){e.liveClassGradeClassRVMList.forEach(function(e,a){if(e.gradeId==t.gradeId){var s=!0;t.children.forEach(function(t,a){t.classId==e.classId&&(s=!1)}),s&&t.children.push({classId:e.classId,className:e.className})}})})),e.liveClassStudentVMList&&e.liveClassStudentVMList.forEach(function(e,t){s.push({userName:"",userId:e.userId,classId:"",className:"",number:"",gradeValue:"",gradeName:"",gradeId:""})}),t.form.grades=a,t.form.students=s,t.form.studentNames=r.join("，"),t.dialogLoading=!1}).catch(function(e){t.dialogLoading=!1})},deleteMsg:function(e){var t=this;this.$confirm("是否继续删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.i(s.g)(e.liveId).then(function(e){t.$notify({message:"删除成功",type:"success"}),t.currentPage=1,t.refreshData()})}).catch(function(){})},enterMsg:function(e){this.$router.push({path:"classroom",query:{id:e.liveId}})}}}}});